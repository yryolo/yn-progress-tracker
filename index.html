<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>やりたいこと＆休日プラン進捗トラッカー</title>

<!-- PWA関連 -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0f1115">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
  body {
    background: #0f1115;
    color: white;
    font-family: sans-serif;
    max-width: 600px;
    margin: auto;
    padding: 20px;
  }
  h1 { font-size: 1.4rem; }
  .goal {
    background: #1e1f26;
    margin: 10px 0;
    padding: 10px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  input[type="checkbox"] { transform: scale(1.2); }
  button {
    background: #333;
    color: white;
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    margin-top: 10px;
  }
</style>
</head>
<body>
<h1>やりたいこと＆休日プラン | 進捗トラッカー</h1>
<div id="progress">0%</div>

<div id="goals"></div>

<button id="markAll">全て未完に戻す</button>
<button id="shareText">進捗をメモに共有</button>

<script>
const state = {
  goals: [
    { text: "毎月1回の国内旅行を継続（まずは近場から）", done: false },
    { text: "高配当株ポートフォリオを35銘柄体制にする", done: false },
    { text: "デュエマの副業トライアル（月5,000円以上の利益目標）", done: false },
    { text: "腹筋がしっかり見える体型にする（体脂肪率12〜14％目安）", done: false }
  ]
};

function saveState() {
  localStorage.setItem("yn-tracker", JSON.stringify(state));
}

function loadState() {
  const data = localStorage.getItem("yn-tracker");
  if (data) {
    Object.assign(state, JSON.parse(data));
  }
}

function renderAll() {
  const container = document.getElementById("goals");
  container.innerHTML = "";
  state.goals.forEach((g, i) => {
    const div = document.createElement("div");
    div.className = "goal";
    const label = document.createElement("label");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = g.done;
    checkbox.onchange = () => {
      state.goals[i].done = checkbox.checked;
      saveState();
      updateProgress();
    };
    label.appendChild(checkbox);
    label.appendChild(document.createTextNode(" " + g.text));
    div.appendChild(label);
    container.appendChild(div);
  });
  updateProgress();
}

function updateProgress() {
  const doneCount = state.goals.filter(g => g.done).length;
  const pct = Math.round((doneCount / state.goals.length) * 100);
  document.getElementById("progress").textContent = `${pct}%`;
}

document.getElementById("markAll").onclick = () => {
  if (confirm("すべて未完に戻しますか？")) {
    state.goals.forEach(g => g.done = false);
    saveState();
    renderAll();
  }
};

document.getElementById("shareText").onclick = async () => {
  const doneCount = state.goals.filter(g => g.done).length;
  const pct = Math.round((doneCount / state.goals.length) * 100);
  const text = `進捗率: ${pct}%\n目標: ${state.goals.length}件中${doneCount}件完了`;
  try {
    if (navigator.share) {
      await navigator.share({ text });
    } else {
      await navigator.clipboard.writeText(text);
      alert("クリップボードにコピーしました");
    }
  } catch (e) {}
};

loadState();
renderAll();
</script>

<!-- Service Worker登録 -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js");
  });
}
</script>
</body>
</html>
